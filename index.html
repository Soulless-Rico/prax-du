<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>my absolute snake son</title>
    <style>
        body {
            background: #104950 ;
            text-align: center;
        }

        canvas {
            border: 10px solid #a6a6a6;
        }

        h1 {
            margin-top: 0;
            font-size: 4em;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: bold;
        }

    </style>
</head>

<body>
    
    <canvas width="750" height="750"></canvas>

    <h1>0</h1>

    <script>
        // listeners
        document.addEventListener('keydown', moveDirection)

        // canvas
        const canvas = document.querySelector('Canvas')
        const ctx = canvas.getContext('2d')

        //other elements
        const title = document.querySelector('h1');
        // food
        let foodPosX = 0;
        let foodPosY = 0;

        // game settings
        const tileSize = 50;
        const fps = 10;        
        const tileCountX = canvas.clientWidth / tileSize;
        const tileCountY = canvas.clientHeight / tileSize;
        let gameIsRunnin = true;


        // player properties
        let snakePosX = 0;
        let snakePosY = canvas.clientHeight / 2 - tileSize / 2;
        let snakeSpeed = tileSize; // pixels per frame
        let score = 0;


        let velocityX = 1;
        let velocityY = 0;

        let tail = [];
        let snakeLenght = 2;
        
        function gameCore() {
            if (gameIsRunnin) {
                snakeMovement();
                render();
                checkSnakeForIllegalStuff();
                setTimeout(gameCore, 1000 / fps);
            }
            /** an infinite loop that runs each screen refresh
             requestAnimationFrame(gameCore) */
        };

        function render() {
            
            rectangle('#104950', 0, 0, canvas.clientWidth, canvas.clientHeight);
            gridTheGrid();

            // spawn food
            rectangle('#079ce9', foodPosX, foodPosY, tileSize, tileSize);

            // tail 
            tail.forEach(snakepart => 
                rectangle('#555', snakepart.x, snakepart.y, tileSize, tileSize)
            ) 

            // snake
            rectangle('black', snakePosX, snakePosY, tileSize, tileSize, tileSize);
        };

        function gridTheGrid() {
            for ( let i = 0; i < tileCountX ; i++) { // ALE JA CHCEM POKRYT ABSOLUTNE VSETKO SVOJOU BIELOU FARBOU
                for (let j = 0; j < tileCountY; j++) {                rectangle(
                '#fff',
                tileSize * i,
                tileSize * j,
                tileSize - 1,
                tileSize - 1);
                };
            };  
        };


        function snakeMovement() {

            snakePosX += snakeSpeed * velocityX
            snakePosY += snakeSpeed * velocityY

        };


        function moveDirection(event) {

            switch (event.key) {

                case 'ArrowUp':

                    if (velocityY !== 1) { // make sure we cant make a 180 degree turn
                    velocityX = 0;
                    velocityY = -1;
                    };
                    break;

                case 'ArrowDown':

                    if (velocityY !== -1) {
                    velocityX = 0;
                    velocityY = 1;
                    };
                    break;
                    
                case 'ArrowLeft':
                    
                if (velocityX !== 1) {
                    velocityX = -1;
                    velocityY = 0;
                    };
                    break;
                    
                case 'ArrowRight':
                    if (velocityX !== -1) {
                    velocityX = 1;
                    velocityY = 0;
                    };
                    break;
                
                default:
                    // restart game
                    if (! gameIsRunnin ) location.reload()
            }
        };


        function checkSnakeForIllegalStuff() {

            // wall collision

           // right side border
           if (snakePosX > canvas.clientWidth)
            { snakePosX = 0 };

           // left side border
           if (snakePosX < 0)
            { snakePosX = canvas.clientWidth };

           // bottom side border
           if (snakePosY > canvas.clientHeight) 
            { snakePosY = 0 };

           // top side border
           if (snakePosY < 0)
            { snakePosY = canvas.clientHeight };

            // food collision

            if ( snakePosX === foodPosX && snakePosY === foodPosY) {
                title.innerText = ++score;
                snakeLenght++;
                respawnFood();
            }

            // snake collision

            tail.forEach( snakePart => {
                if (snakePosX === snakePart.x && snakePosY === snakePart.y) {
                    gameIsRunnin = false;
                    title.innerHTML = '<strong> you lost </strong>'
                }
            })

            // tail
            tail.push({ x: snakePosX, y : snakePosY});

            tail = tail.splice(-1 * snakeLenght);
        };

        function respawnFood() {
                foodPosX = Math.floor(Math.random() * tileCountX) * tileSize;
                foodPosY = Math.floor(Math.random() * tileCountY) * tileSize;
            };

        
        function rectangle(color, x, y, width, height) {

            ctx.fillStyle = color;
            ctx.fillRect(x, y, width , height);
        };

        respawnFood();
        gameCore();
        
    </script>


</body>
</html>